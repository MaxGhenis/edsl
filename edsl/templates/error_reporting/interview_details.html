<div class="question">question_name: {{ question }}</div>

<table border="1">
    <tr>
        <th>What</th>
        <th>Values</th>
    </tr>
    <tr>
        <td>Interview ID</td>
        <td>{{ index }}</td>
    </tr>
    <tr>
        <td>Question name (question_name)</td>
        <td>{{ question }}</td>
    </tr>
    <tr>
        <td>Human-readable question</td>
        <td>{{ interview.survey.get_question(question).html() }}</td>
    </tr>
    <tr>
        <td>Scenario</td>
        <td>{{ interview.scenario._repr_html_() }}</td>
    </tr>
    <tr>
        <td>Agent</td>
        <td>{{ interview.agent._repr_html_() }}</td>
    </tr>
    <tr>
        <td>Model</td>
        <td>{{ interview.model._repr_html_() }}</td>
    </tr>
</table>

<h2>Exception details</h2>

{% for exception_message in exceptions %}
<div class="exception-detail">
        <div class="exception-header">
        <span class="exception-exception">Exception: {{ exception_message.name }}</span>
        <button class="toggle-btn">â–¼</button>
        </div>
        <div class="exception-content">
            {% if exception_message.exception.__class__.__name__ == 'QuestionAnswerValidationError' %}        
            <h3>Answer validation details</h3>
            <table border="1">
                <tr>
                    <th>Field</th>
                    <th>Value</th>
                </tr>
                {% for field, (explanation, open_tag, close_tag, value) in exception_message.exception.to_html_dict().items() %}
                
                <tr>
                    <td>{{ field }}: ({{ explanation }})</td>
                    <td><{{open_tag}}> {{ value | escape }} <{{close_tag}}></td>
                </tr>
                {% endfor %}
            </table>
        {% endif %}
            <h3>Rendered prompts:</h3>
            <p>For example, if the model is a text model, the rendered prompts will show the text that was sent to the model.</p>
            <table border="1">
                <tr>
                    <th>Prompt Type</th>
                    <th>Text</th>
                </tr>
                {% for prompt_type, value in exception_message.rendered_prompts.items() %}
                <tr>
                    <td>{{ prompt_type }}</td>
                    <td>{{ value }}</td>
                </tr>
                {% endfor %}
            </table>

            <div class="exception-time">Time: {{ exception_message.time }}</div>
            <h3>Full raw model response:</h3>
            <div class="model-response">
            <pre>
            {{ exception_message.raw_model_response }}
            </pre>
            </div>            
            <div class="exception-traceback">Traceback: 
                <text>
                <pre>{{ exception_message.traceback }}</pre>
                </text>
            </div>
        </div>
    </div>

{% endfor %}